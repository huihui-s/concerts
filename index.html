<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的演唱會紀錄</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 10px;
        }

        /* 新增紀錄表單 */
        .record-form {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .record-form h2 {
            text-align: center;
            color: #34495e;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .record-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .record-form input[type="text"],
        .record-form input[type="date"],
        .record-form textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box; /* 確保 padding 不增加寬度 */
        }

        .record-form textarea {
            resize: vertical;
            min-height: 80px;
        }

        .record-form button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .record-form button:hover {
            background-color: #45a049;
        }

        .message-area {
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        .message-area.success { color: #27ae60; }
        .message-area.error { color: #c0392b; }
        .message-area.info { color: #d35400; }


        /* 演唱會卡片區塊 */
        .concert-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* 卡片間距 */
            justify-content: center; /* 水平居中 */
        }

        .concert-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex; /* 使用 Flexbox 進行圖片和文字排版 */
            width: 100%; /* 確保在任何螢幕尺寸下都單列顯示 */
            max-width: 600px; /* 設定最大寬度以避免在超寬螢幕上過大 */
            min-height: 180px; /* 設定最小高度確保卡片高度一致 */
            height: auto; /* 讓高度根據內容調整，但結合 min-height 確保一致性 */
            box-sizing: border-box;
            position: relative; /* 用於票根效果定位 */
            padding-bottom: 10px; /* 為票根效果預留空間 */
        }

        .concert-card-image {
            flex: 0 0 40%; /* 圖片佔卡片寬度的40% */
            overflow: hidden;
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }

        .concert-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 圖片適應性縮放，填充容器並裁切 */
            display: block;
        }

        .concert-card-content {
            flex: 1; /* 文字內容佔剩餘空間，即60% */
            padding: 15px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center; /* 垂直居中內容 */
        }

        .concert-card h3 {
            font-size: 1.5em; /* 演唱會名稱更大 */
            font-weight: bold; /* 粗體 */
            margin-top: 0;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .concert-card p {
            font-size: 0.95em;
            margin-bottom: 5px;
            color: #555;
        }

        .concert-card p strong {
            color: #34495e;
        }

        /* 票根效果 */
        .ticket-style {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px; /* 票根效果的高度 */
            background-image:
                /* 下半圓，向下凹陷 */
                radial-gradient(circle at 5px -5px, transparent 10px, #ffffff 10px),
                radial-gradient(circle at 5px 15px, #ffffff 10px, transparent 10px);
            background-size: 10px 20px; /* 每個半圓的寬高 */
            background-repeat: repeat-x; /* 水平重複 */
            background-position: 0 0; /* 起始位置 */
        }
        /* 右側票根效果 */
        .ticket-style::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 10px; /* 票根效果的寬度 */
            height: calc(100% - 10px); /* 考慮底部票根的高度 */
            background-image:
                /* 右側半圓，向左凹陷 */
                radial-gradient(circle at -5px 5px, transparent 10px, #ffffff 10px),
                radial-gradient(circle at 15px 5px, #ffffff 10px, transparent 10px);
            background-size: 20px 10px; /* 每個半圓的寬高 */
            background-repeat: repeat-y; /* 垂直重複 */
            background-position: 0 0; /* 起始位置 */
        }
        /* 左側票根效果 */
        .ticket-style::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 10px; /* 票根效果的寬度 */
            height: calc(100% - 10px); /* 考慮底部票根的高度 */
            background-image:
                /* 左側半圓，向右凹陷 */
                radial-gradient(circle at 15px 5px, transparent 10px, #ffffff 10px),
                radial-gradient(circle at -5px 5px, #ffffff 10px, transparent 10px);
            background-size: 20px 10px; /* 每個半圓的寬高 */
            background-repeat: repeat-y; /* 垂直重複 */
            background-position: 0 0; /* 起始位置 */
        }


        /* 媒體查詢：針對小螢幕調整 */
        @media (max-width: 768px) {
            .concert-card {
                flex-direction: column; /* 小螢幕下圖片和文字垂直堆疊 */
            }

            .concert-card-image {
                flex: none; /* 取消 flex 屬性 */
                width: 100%; /* 圖片佔滿寬度 */
                height: 200px; /* 設定一個固定高度或根據需求調整 */
                border-bottom-left-radius: 0;
                border-top-right-radius: 12px; /* 調整圓角 */
            }

            .concert-card-image img {
                height: 100%; /* 確保圖片填充高度 */
            }

            .concert-card-content {
                flex: none;
                width: 100%;
                padding-top: 10px; /* 調整內邊距 */
                border-top-left-radius: 0; /* 調整圓角 */
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>我的演唱會紀錄</h1>
    </header>

    <div class="container">
        <section class="record-form">
            <h2>新增演唱會紀錄</h2>
            <form id="concertForm">
                <label for="concertName">演唱會名稱:</label>
                <input type="text" id="concertName" name="Concert Name" required>

                <label for="artist">藝人/樂團:</label>
                <input type="text" id="artist" name="Artist" required>

                <label for="date">日期:</label>
                <input type="date" id="date" name="Date" required>

                <label for="location">地點:</label>
                <input type="text" id="location" name="Location" required>

                <label for="imageUrl">圖片網址 (可選):</label>
                <input type="text" id="imageUrl" name="Image URL">

                <label for="notes">備註 (可選):</label>
                <textarea id="notes" name="Notes"></textarea>

                <button type="submit">新增紀錄</button>
                <p class="message-area" id="formMessage"></p>
            </form>
        </section>

        <section>
            <h2>所有演唱會</h2>
            <div class="concert-grid" id="concertsContainer">
                <p id="loadingMessage" class="message-area info">載入中...</p>
                </div>
        </section>
    </div>

    <script>
        // 將此替換為您部署的 Google Apps Script Web 應用程式 URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxAy0SBDS8oeFMRD5tFRQyLJMQweUFyGAoEjjYlmbGKbEVCHHGukMNznELGDUQPe-xZsQ/exec';
        const concertsContainer = document.getElementById('concertsContainer');
        const formMessage = document.getElementById('formMessage');
        const loadingMessage = document.getElementById('loadingMessage');

        // 輔助函式：顯示訊息
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `message-area ${type}`;
        }

        // 輔助函式：創建演唱會卡片 HTML
        function createConcertCard(record) {
            const card = document.createElement('div');
            card.className = 'concert-card';
            const defaultImageUrl = 'https://via.placeholder.com/200x150?text=No+Image'; // 預設圖片

            card.innerHTML = `
                <div class="concert-card-image">
                    <img src="${record ['Image URL'] || defaultImageUrl}" alt="${record['Concert Name'] || '演唱會圖片'}">
                </div>
                <div class="concert-card-content">
                    <h3>${record['Concert Name'] || '未命名演唱會'}</h3>
                    <p><strong>藝人:</strong> ${record['Artist'] || 'N/A'}</p>
                    <p><strong>日期:</strong> ${record['Date'] ? new Date(record['Date']).toLocaleDateString() : 'N/A' }</p>
                    <p><strong>地點:</strong> ${record['Location'] || 'N/A'}</p>
                    <p><strong>座位:</strong> ${record['Seat'] || 'N/A'}</p>
                    <p><strong>票價:</strong> ${record['Price'] || 'N/A'}</p>
                    <p>${record['Notes'] || ''}</p>
                </div>
                <div class="ticket-style"></div>
            `;
            return card;
        }

        // 載入演唱會資料並渲染到頁面
        async function loadConcerts() {
            concertsContainer.innerHTML = ''; // 清空現有卡片
            showMessage(loadingMessage, '載入中...', 'info');

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });

                const result = await response.json();

                if (result.result === 'success') {
                    if (result.data && result.data.length > 0) {
                        result.data.forEach(record => {
                            const card = createConcertCard(record);
                            concertsContainer.appendChild(card);
                        });
                        loadingMessage.style.display = 'none'; // 隱藏載入訊息
                    } else {
                        showMessage(loadingMessage, '目前沒有演唱會紀錄，請新增！', 'info');
                    }
                } else {
                    showMessage(loadingMessage, '載入失敗: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error loading concerts:', error);
                showMessage(loadingMessage, '載入演唱會時發生錯誤。請檢查網路或稍後再試。', 'error');
            }
        }

        // 表單提交處理
        document.getElementById('concertForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // 阻止表單預設提交行為

            showMessage(formMessage, '正在提交...', 'info');

            const formData = {
                concertName: document.getElementById('concertName').value,
                artist: document.getElementById('artist').value,
                date: document.getElementById('date').value,
                location: document.getElementById('location').value,
                imageUrl: document.getElementById('imageUrl').value,
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.result === 'success') {
                    showMessage(formMessage, '紀錄新增成功！', 'success');
                    document.getElementById('concertForm').reset(); // 清空表單
                    await loadConcerts(); // 重新載入並顯示最新資料
                } else {
                    showMessage(formMessage, '新增失敗: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                showMessage(formMessage, '提交時發生錯誤。請檢查網路或稍後再試。', 'error');
            }
        });

        // 頁面載入時自動載入現有紀錄
        document.addEventListener('DOMContentLoaded', loadConcerts);
    </script>
</body>
</html>